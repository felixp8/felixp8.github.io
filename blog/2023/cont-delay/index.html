<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>approximation of discrete delays with continuous-time dynamics | Felix Pei</title> <meta name="author" content="Felix Pei"> <meta name="description" content="some pointless and basic math noodling"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://felixp8.github.io/blog/2023/cont-delay/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Felix Pei</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">approximation of discrete delays with continuous-time dynamics</h1> <p class="post-meta">November 27, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/math"> <i class="fa-solid fa-hashtag fa-sm"></i> math</a>   <a href="/blog/tag/code"> <i class="fa-solid fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/dynamical-systems"> <i class="fa-solid fa-tag fa-sm"></i> dynamical-systems</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In discrete-time dynamical systems, it’s easy to create a state variable that is a time-delayed copy of another. For example, if we have a linear system</p> \[\begin{bmatrix} x_1(t + 1) \\ x_2(t + 1) \\ x_3(t + 1) \end{bmatrix} = A \cdot \begin{bmatrix} x_1(t) \\ x_2(t) \\ x_3(t) \end{bmatrix}\] <p>and we want \(x_3\) to be equal to \(x_1\), but delayed by one timestep, we can design A as</p> \[\begin{bmatrix} a_{11} &amp; a_{12} &amp; a_{13} \\ a_{21} &amp; a_{22} &amp; a_{23} \\ 1 &amp; 0 &amp; 0 \end{bmatrix}\] <p>so that \(x_3(t + 1) = x_1(t)\). Of course, we can only ever create delays of exactly one timestep, and to achieve greater delays we’d need to chain multiple variables each delayed by a timestep. More generally, in discrete-time systems, state variables can only affect each other with a one timestep delay.</p> <p>In continuous-time systems, state variables affect each other instantaneously. It is therefore not obvious how to recreate this sort of time-delayed relationship between variables, though this occurs often in real-world systems, e.g. in interacting brain regions. This problem has been extensively studied in a variety of fields, but because I am too lazy to look into it, I just messed around a bit myself and found a solution that is probably pretty useless.</p> <h2 id="problem-statement">Problem statement</h2> <p>Let me try to state the problem a little more clearly. We have a continuous-time dynamical system</p> \[\dot{x} = f(x,u)\] <p>where \(x \in \mathbb{R}^{N}\). We want to make some sort of coupled dynamical system with a new state variable \(y\) so that \(y(t) = x_{i}(t - \tau)\) for some index \(i \in [1, N]\) and some delay \(\tau &gt; 0\). This means that we want</p> \[\dot{y}(t) = \dot{x}_{i}(t - \tau).\] <p>In theory, we could maintain an entire delayed copy of \(x\) and compute \(\dot{x}_{i}(t - \tau)\) just from \(f\), but this is generally impractical because 1) we’d need to also store all external inputs \(u(t)\) for \([t - \tau, t]\) 2) we’d need to exactly initialize this copied system to exactly \(x(t - \tau)\) Instead, if we could estimate \(\dot{x}_{i}(t - \tau)\) purely from observables at time \(t\) and allow for some margin of error in initializing \(y\) where \(y\) still converges to \(x_{i}(t - \tau)\), that would be potentially less accurate but more useful.</p> <h2 id="prior-work-finite-differences">Prior work: Finite differences</h2> <p>Though I didn’t do much research on prior work, I did look at the first search result, which was this paper<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>. The method proposed there is very simple: approximate the time derivative with the difference between \(x_{i}(t)\) and \(y(t)\) divided by \(\tau\). If \(y(t)\) is equal to \(x_{i}(t - \tau)\), then the estimate is equal to \((x_{i}(t) - x_{i}(t - \tau)) / \tau\), which converges to \(\dot{x}_{i}(t - \tau)\) as \(\tau \to 0\). In general, we can expect that the estimate is pretty decent as long as \(\tau\) is small relative to the timescale of \(x_{i}\).</p> <p>As you can imagine, this is not very accurate for larger \(\tau\), so instead of going straight for \(\tau\), you can instead break up the delay into many smaller intervals where each derivative estimate is likely to be more accurate. The resulting system would look something like this:</p> <p>\(\dot{x} = f(x,u)\) \(\dot{y}_1 = (x_i - y_1) / \Delta t\) \(\dot{y}_2 = (y_1 - y_2) / \Delta t\) \(...\) \(\dot{y}_m = (y_{m-1} - y_m) / \Delta t\)</p> <p>where \(m = \tau / \Delta t\). If it helps to see it in matrix form, the above could also be written like this:</p> \[\begin{bmatrix} \dot{x} \\ \dot{y}_1 \\ \\ \vdots \\ \\ \dot{y}_m \end{bmatrix} = \begin{bmatrix} f_{lin} &amp; 0 &amp; &amp; \dots &amp; &amp; 0 \\ \frac{1}{\Delta t} &amp; -\frac{1}{\Delta t} &amp; 0 &amp; &amp; \dots &amp; \\ 0 &amp; \frac{1}{\Delta t} &amp; -\frac{1}{\Delta t} &amp; &amp; \dots &amp; \\ &amp; &amp; \ddots &amp; \ddots &amp; &amp; \\ &amp; &amp; &amp; \ddots &amp; \ddots &amp; \\ 0 &amp; &amp; \dots &amp; &amp; \frac{1}{\Delta t} &amp; -\frac{1}{\Delta t} \end{bmatrix} \begin{bmatrix} x \\ y_1 \\ \\ \vdots \\ \\ y_m \end{bmatrix} + \begin{bmatrix} 1 \\ 0 \\ \\ \vdots \\ \\ 0 \end{bmatrix} f_{nonlin}(x,u)\] <p>where \(f_{lin}\) is whatever component of \(f\) can be represented as a linear function of \(x\) and \(f_{nonlin}\) is everything else. (The weird notation of \(f_{lin}\) and \(f_{nonlin}\) is irrelevant though - the main idea is the rest of the matrix!)</p> <p>Notice that if our integration timestep is also \(\Delta t\), then we have recreated the original discrete system. (The -1’s on the diagonal would be canceled out by adding the identity matrix, since discrete systems output the next state, not the difference between the current and next state.)</p> <p>Notice also that the system sort of self-corrects for inaccurate initializations. If \(\Delta t\) is small enough, we can suppose that all gradient estimates are accurate when \(y\) values are accurate, e.g. \(\dot{y}_1(t) = (x_i(t) - y_1(t)) / \Delta t \approx \dot{x}_{i}(t - \Delta t)\) when \(y_1(t) \approx x_{i}(t - \Delta t)\). If initialization is bad, so \(y_1(t) &lt; x_{i}(t - \Delta t)\), then \(\dot{y}_1(t) = (x_i(t) - y_1(t)) / \Delta t &gt; \dot{x}_{i}(t - \Delta t)\), which compensates for the inaccurate initialization. The same is true if \(y_1(t) &gt; x_{i}(t - \Delta t)\).</p> <p>This method can also be extended with central differences or unevenly-spaced \(y\) points, which may give better accuracy<sup id="fnref:1:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup><sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>.</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1" role="doc-endnote"> <p>Sun, Jian-Qiao. A method of continuous time approximation of delayed dynamical systems. In <em>Communications in Nonlinear Science and Numerical Simulation</em>, 2009. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:1:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a></p> </li> <li id="fn:2" role="doc-endnote"> <p>Butcher, Eric A. and Bobrenkov, Oleg A. On the Chebyshev spectral continuous time approximation for constant and periodic delay differential equations. In <em>Communications in Nonlinear Science and Numerical Simulation</em>, 2011. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Felix Pei. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>